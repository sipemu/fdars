---
title: "Seasonality Detection Methods: A Comparative Study"
author: "fdars Package"
date: "2026-01-01"
format:
  pdf:
    pdf-engine: pdflatex
    toc: true
    toc-depth: 3
    number-sections: true
    colorlinks: true
    geometry:
      - margin=0.75in
    fig-width: 7
    fig-height: 5
execute:
  echo: true
  warning: false
  message: false
---

# Executive Summary

## Key Findings

This study compared six methods for detecting seasonality in functional time series data across 550+ simulated curves with varying seasonal strengths and trend components.

| Method | F1 Score | False Positive Rate | Robustness to Trends |
|--------|----------|---------------------|----------------------|
| **Wavelet Strength** | **97.8%** | 4% | Excellent (1.2% F1 drop) |
| Variance Strength | 97.3% | **2%** | Excellent (0.4% F1 drop) |
| Spectral Strength | 95.3% | 10% | Good (3.9% F1 drop) |
| FFT Confidence | 94.8% | 4% | Good (2.0% F1 drop) |
| AIC Comparison | 91.5% | 18% | Moderate (5.7% F1 drop) |
| ACF Confidence | 85.4% | 10% | Moderate (4.5% F1 drop) |

**Top methods**: Wavelet (97.8% F1, best recall) and Variance (97.3% F1, lowest FPR) are both excellent choices for seasonality detection.

## Robustness to Real-World Challenges

| Challenge | Most Affected | Wavelet Advantage |
|-----------|---------------|-------------------|
| **Red Noise (AR(1))** | FFT (100% FPR) | Moderate (up to 36% FPR) |
| **Multiple Seasonalities** | Variance (4% TPR) | Good (56% TPR) |
| **Amplitude Modulation** | Variance (18% TPR) | **Excellent (72% TPR)** |
| **Outliers (10%, 10x)** | ACF (6% TPR) | Good (62% TPR) |

**Robustness ranking**: FFT > Spectral > Wavelet > Variance > ACF; Wavelet excels on amplitude modulation.

## Recommendations

### Primary Recommendation: Use Variance Strength

```r
# Detect seasonality with Variance Strength method
period <- 0.2  # Period in argvals units (e.g., 1/5 for 5 cycles in [0,1])
strength <- seasonal_strength(fd, period = period, method = "variance", detrend = "linear")
is_seasonal <- strength > 0.2
```

### When Period is Unknown: Two-Step Approach

```r
# Step 1: Estimate period using FFT (no period required)
result <- estimate_period(fd, method = "fft", detrend = "linear")
estimated_period <- result$period

# Step 2: Measure strength with estimated period
strength <- seasonal_strength(fd, period = estimated_period, method = "variance")
is_seasonal <- strength > 0.2
```

### Critical Notes

1. **Period units matter**: The `period` parameter must be in argvals units, not raw time units
2. **Avoid FFT for slow oscillations**: FFT has 100% false positive rate when non-seasonal oscillations are present
3. **Thresholds are calibrated**: All thresholds target ~5% false positive rate on pure noise

\newpage

# Introduction

This report describes and compares six methods for detecting seasonality in functional time series data. We evaluate each method's performance across different scenarios including varying seasonal strengths, non-linear trends, colored noise, multiple seasonalities, amplitude modulation, and outliers.

The goal is to answer: **Given a time series, how can we reliably determine if it contains a seasonal pattern?**

**Report Structure**:

- @sec-methods -- Six detection methods and their mathematical formulations
- @sec-sim -- Unified simulation study covering seven scenarios
- @sec-am-char -- Post-detection amplitude modulation characterization
- @sec-findings -- Key findings and recommendations

# Detection Methods {#sec-methods}

## AIC Comparison (Fourier vs P-spline)

**Concept**: If data is seasonal, a Fourier basis should fit better than P-splines because Fourier bases naturally capture periodic patterns.

**Mathematical formulation**:

For a curve $y(t)$, we fit two models:

1. **Fourier basis**: $\hat{y}(t) = \sum_{k=0}^{K} a_k \cos(2\pi k t) + b_k \sin(2\pi k t)$

2. **P-spline**: $\hat{y}(t) = \sum_{j=1}^{J} c_j B_j(t)$ with penalty $\lambda \int [\hat{y}''(t)]^2 dt$

We compute AIC for each:
$$\text{AIC} = n \log(\text{RSS}/n) + 2 \cdot \text{edf}$$

where RSS is the residual sum of squares and edf is the effective degrees of freedom.

**Detection rule**: Seasonality detected if $\text{AIC}_{\text{P-spline}} - \text{AIC}_{\text{Fourier}} > 0$

**Interpretation**: When Fourier has lower AIC, the periodic structure is significant enough to justify the global periodic assumption over the local flexibility of splines.

## FFT Confidence

**Concept**: Use Fast Fourier Transform to detect dominant frequencies. Strong peaks in the periodogram indicate periodic components.

**Mathematical formulation**:

Given a time series $y_1, y_2, \ldots, y_n$, compute the discrete Fourier transform:
$$Y_k = \sum_{j=1}^{n} y_j e^{-2\pi i (j-1)(k-1)/n}$$

The periodogram (power spectrum) is:
$$P_k = |Y_k|^2$$

**Detection score**:
$$\text{Confidence} = \frac{\max_k P_k}{\text{mean}(P_k)}$$

**Detection rule**: Seasonality detected if Confidence $> 6.0$

**Interpretation**: A high ratio indicates one frequency dominates, suggesting periodicity rather than random noise.

## ACF Confidence

**Concept**: Autocorrelation at the seasonal lag should be high for seasonal data.

**Mathematical formulation**:

The autocorrelation function at lag $h$ is:
$$\rho_h = \frac{\sum_{t=1}^{n-h}(y_t - \bar{y})(y_{t+h} - \bar{y})}{\sum_{t=1}^{n}(y_t - \bar{y})^2}$$

For seasonal data with period $p$, we expect $\rho_p$ to be significantly positive.

**Detection rule**: Seasonality detected if ACF confidence $> 0.25$

**Interpretation**: High autocorrelation at the seasonal lag indicates the pattern repeats.

## Variance Strength

**Concept**: Decompose variance into seasonal and residual components. High seasonal variance ratio indicates seasonality.

**Mathematical formulation**:

Decompose the series: $y_t = T_t + S_t + R_t$ (trend + seasonal + residual)

The seasonal strength is:
$$\text{SS}_{\text{var}} = 1 - \frac{\text{Var}(R_t)}{\text{Var}(y_t - T_t)}$$

**Detection rule**: Seasonality detected if $\text{SS}_{\text{var}} > 0.2$

**Interpretation**: Values close to 1 mean the seasonal component dominates; values close to 0 mean residual noise dominates.

**Important**: The `period` parameter must be in the same units as `argvals`. For data normalized to [0,1] with 5 annual cycles, use `period = 0.2`.

## Spectral Strength

**Concept**: Measure the proportion of spectral power at the seasonal frequency.

**Mathematical formulation**:

Using the periodogram $P_k$, identify the seasonal frequency $f_s = 1/\text{period}$.

$$\text{SS}_{\text{spectral}} = \frac{\sum_{k \in \mathcal{S}} P_k}{\sum_{k} P_k}$$

where $\mathcal{S}$ includes the seasonal frequency and its harmonics.

**Detection rule**: Seasonality detected if $\text{SS}_{\text{spectral}} > 0.3$

**Interpretation**: High values indicate spectral energy is concentrated at seasonal frequencies.

## Wavelet Strength

**Concept**: Use continuous wavelet transform (CWT) to measure power at the seasonal scale, capturing time-localized periodic patterns.

**Mathematical formulation**:

Using the Morlet wavelet $\psi_0(t) = \pi^{-1/4} e^{i\omega_0 t} e^{-t^2/2}$ with $\omega_0 = 6$, compute the CWT at scale $s = \text{period} \cdot \omega_0 / (2\pi)$:

$$W(s, \tau) = \int y(t) \frac{1}{\sqrt{s}} \psi^*\left(\frac{t - \tau}{s}\right) dt$$

The wavelet strength is:
$$\text{SS}_{\text{wavelet}} = \sqrt{\frac{\text{mean}(|W(s, \tau)|^2)}{\text{Var}(y)}}$$

**Detection rule**: Seasonality detected if $\text{SS}_{\text{wavelet}} > 0.26$

**Interpretation**: Unlike global spectral methods, wavelet analysis localizes power in time, making it robust to non-stationary signals and amplitude modulation.

**Advantages**:

- Handles time-varying seasonality better than FFT
- Less sensitive to edge effects than variance decomposition
- Naturally filters non-seasonal low-frequency trends

# Simulation Study {#sec-sim}

This section presents a unified simulation study covering seven scenarios that test detection methods under progressively challenging conditions.

## Baseline: Varying Seasonal Strength {#sec-sim-baseline}

**Setup**: Test detection across 11 seasonal strength levels (0.0 to 1.0), with 50 curves per level, 60 observations (5 years monthly), and white noise ($\sigma = 0.3$). Ground truth: seasonal if $s \geq 0.2$.

![Example curves at different seasonal strength levels](plots/example_sim1_seasonal_strength.pdf){width="7in"}

![Detection rates by seasonal strength](plots/seasonality_detection_comparison.pdf){width="7in"}

| Method | F1 Score | Precision | Recall | FPR |
|--------|----------|-----------|--------|-----|
| **Wavelet Strength** | **97.8%** | 96.9% | 98.7% | 4.0% |
| Variance Strength | 97.3% | 98.2% | 96.4% | 2.0% |
| Spectral Strength | 95.3% | 97.4% | 93.3% | 10.0% |
| FFT Confidence | 94.8% | 99.3% | 90.7% | 4.0% |
| AIC Comparison | 91.5% | 94.3% | 88.9% | 18.0% |
| ACF Confidence | 85.4% | 98.3% | 75.6% | 10.0% |

**Key finding**: Wavelet and Variance Strength achieve the highest F1 scores (~97.5%). Variance has lowest FPR (2%), Wavelet has highest recall (98.7%).

\newpage

## Non-linear Trends {#sec-sim-trend}

**Setup**: 6 seasonal strength levels x 6 trend strength levels, 30 curves each. Non-linear trend includes quadratic, cubic, and sigmoid components.

![Example curves with fixed seasonality (s=0.5) and varying trend strength](plots/example_sim2_nonlinear_trend.pdf){width="7in"}

![Detection rates heatmap by seasonal and trend strength](plots/seasonality_detection_trend_heatmaps.pdf){width="7in"}

| Method | No Trend F1 | Max Trend F1 | F1 Drop |
|--------|-------------|--------------|---------|
| **Variance** | 97.3% | 96.9% | **0.4%** |
| Wavelet | 94.1% | 92.9% | 1.2% |
| FFT | 93.7% | 91.8% | 2.0% |
| Spectral | 96.3% | 92.5% | 3.9% |
| ACF | 87.4% | 83.5% | 4.5% |
| AIC | 92.2% | 87.0% | 5.7% |

**Key finding**: Variance Strength is most robust to non-linear trends with only 0.4% F1 drop; Wavelet Strength also shows excellent trend robustness.

\newpage

## Multiple Trend Types {#sec-sim-trend-types}

**Setup**: Test 8 trend types (none, linear, quadratic, cubic, exponential, logarithmic, sigmoid, slow sine) at varying strengths.

![Example curves combining each trend type with seasonality](plots/example_sim3_trend_types.pdf){width="7in"}

![F1 scores by trend type](plots/seasonality_detection_trend_types_f1.pdf){width="7in"}

| Trend Type | Variance | Spectral | Wavelet | FFT | ACF | AIC |
|------------|----------|----------|---------|-----|-----|-----|
| none | 97% | 96% | 94% | 94% | 85% | 92% |
| linear | 97% | 94% | 94% | 93% | 83% | 89% |
| quadratic | 96% | 94% | 93% | 91% | 82% | 88% |
| slow_sine | 96% | 95% | 93% | **0%** | 81% | 87% |

**Key finding**: FFT has catastrophic 100% FPR on slow_sine trend because it detects the non-seasonal oscillation; other methods remain robust.

\newpage

## Red Noise (AR(1)) {#sec-sim-red-noise}

**Setup**: Test with AR(1) noise at $\phi \in \{0, 0.3, 0.5, 0.7, 0.9\}$ to simulate autocorrelated errors common in physical measurements.

![Example time series with different noise types](plots/example_red_noise.pdf){width="7in"}

![False positive rate vs AR(1) coefficient](plots/robustness_red_noise_fpr.pdf){width="7in"}

| AR(1) $\phi$ | Variance | Spectral | Wavelet | FFT | ACF |
|--------------|----------|----------|---------|-----|-----|
| 0.0 | 0% | 10% | 0% | 14% | 0% |
| 0.3 | 2% | 2% | 0% | 32% | 0% |
| 0.5 | 4% | 6% | 16% | 76% | 2% |
| 0.7 | 12% | 6% | 36% | 98% | 16% |
| 0.9 | 6% | 2% | 22% | **100%** | 28% |

**Key finding**: FFT is catastrophically affected by red noise (FPR reaches 100%). Wavelet shows moderate sensitivity (up to 36% at phi=0.7). Variance and Spectral remain most robust.

\newpage

## Multiple Seasonalities {#sec-sim-multi}

**Setup**: Primary seasonality at 5 cycles, secondary at 15-25 cycles. Test detection when only primary period is specified.

![Example time series with multiple seasonal components](plots/example_multi_seasonal.pdf){width="7in"}

![TPR by primary and secondary seasonal strength](plots/robustness_multi_seasonal.pdf){width="7in"}

| Primary | Secondary | Variance | Spectral | Wavelet | FFT | ACF |
|---------|-----------|----------|----------|---------|-----|-----|
| 0.3 | 0.3 | 100% | 100% | 100% | 100% | 8% |
| 0.3 | 0.5 | 34% | 100% | 100% | 100% | 100% |
| 0.3 | 0.7 | **4%** | 100% | 56% | 100% | 100% |
| 0.5 | 0.5 | 100% | 100% | 100% | 100% | 98% |
| 1.0 | 0.7 | 100% | 100% | 100% | 100% | 100% |

**Key finding**: Variance Strength fails when secondary seasonality dominates (TPR drops to 4%); Spectral and FFT detect any periodicity regardless of which component dominates; Wavelet degrades to 56% when secondary is much stronger.

\newpage

## Amplitude Modulation {#sec-sim-amp-mod}

**Setup**: Test time-varying amplitude patterns: constant, linear_growth, linear_decay, and emergence (signal only in second half).

![Example time series with different amplitude modulation types](plots/example_amplitude_modulation.pdf){width="7in"}

![TPR by amplitude modulation type and base amplitude](plots/robustness_amplitude_modulation.pdf){width="7in"}

| Modulation | Variance | Spectral | Wavelet | FFT | ACF |
|------------|----------|----------|---------|-----|-----|
| constant | 100% | 100% | 100% | 100% | 26% |
| linear_growth | 48% | 58% | 82% | 90% | 4% |
| linear_decay | 48% | 58% | 82% | 88% | 0% |
| emergence | **18%** | 24% | **72%** | 76% | 4% |

**Key finding**: "Emergence" pattern is most challenging; Wavelet (72%) significantly outperforms Variance (18%) and Spectral (24%) due to time-localization; FFT remains most robust overall.

\newpage

## Outliers {#sec-sim-outliers}

**Setup**: Add contaminated noise with outlier probability $p \in \{2\%, 5\%, 10\%\}$ and magnitude multiplier $k \in \{3, 5, 10\}$.

![Example time series with different outlier severities](plots/example_outliers.pdf){width="7in"}

![Impact of outliers on TPR](plots/robustness_outliers.pdf){width="7in"}

| Outliers | Magnitude | Variance | Spectral | Wavelet | FFT | ACF |
|----------|-----------|----------|----------|---------|-----|-----|
| 2% | 5x | 100% | 100% | 100% | 100% | 82% |
| 5% | 5x | 100% | 100% | 100% | 100% | 46% |
| 5% | 10x | 68% | 84% | 88% | 88% | 18% |
| 10% | 5x | 98% | 100% | 100% | 100% | 20% |
| 10% | 10x | **48%** | 56% | 62% | 72% | **6%** |

**Key finding**: ACF is most sensitive to outliers; Variance degrades at extreme levels (10%, 10x); Wavelet and FFT show good robustness; pre-filtering recommended.

\newpage

# Amplitude Modulation Characterization {#sec-am-char}

Once a curve is detected as seasonal, the next question is: **Is the seasonality stable or time-varying?**

The `detect_amplitude_modulation()` function analyzes the seasonal envelope to characterize its temporal behavior.

## Methodology

For curves detected as seasonal, we:

1. Extract the envelope using the Hilbert transform
2. Fit a linear model to the envelope: $A(t) = a + bt$
3. Classify based on slope significance and direction:
   - **stable**: $|b/\sigma_b| < 2$ (no significant trend)
   - **emerging**: $b > 0$ and significant
   - **fading**: $b < 0$ and significant
   - **oscillating**: Envelope variance exceeds threshold

## Example Usage

```r
# After detecting seasonality
if (is_seasonal) {
  am <- detect_amplitude_modulation(fd, period = period, method = "hilbert")

  # am$pattern: "stable", "emerging", "fading", or "oscillating"
  # am$slope: envelope trend coefficient
  # am$significance: statistical significance of trend
}
```

## Distribution of Modulation Types

For our simulated seasonal data, the amplitude modulation characterization correctly identifies:

| True Pattern | Detected Pattern | Accuracy |
|--------------|-----------------|----------|
| constant | stable | 94% |
| linear_growth | emerging | 87% |
| linear_decay | fading | 85% |
| emergence | emerging | 72% |

**Key finding**: The characterization works well for smooth amplitude changes but has reduced accuracy for abrupt transitions (emergence pattern).

## Practical Applications

- **Climate data**: Detecting intensifying or weakening seasonal patterns
- **Economic data**: Identifying growing or shrinking seasonal effects
- **Industrial sensors**: Monitoring equipment degradation affecting periodic components

\newpage

# Key Findings {#sec-findings}

## Method Ranking

| Rank | Method | Best For | Weakness |
|------|--------|----------|----------|
| 1 | **Variance Strength** | Highest accuracy, known period | Multiple seasonalities |
| 2 | Spectral Strength | Robust to trends | Slightly higher FPR |
| 3 | Wavelet Strength | Time-varying signals, AM | Lower recall |
| 4 | FFT Confidence | Period unknown | Red noise, slow oscillations |
| 5 | AIC Comparison | Interpretable | Higher FPR |
| 6 | ACF Confidence | Conservative | Misses weak seasonality |

## Critical Issues Found

1. **Period units matter**: The `period` parameter in `seasonal_strength()` must be in argvals units
2. **FFT vulnerable to red noise**: FPR reaches 100% at high autocorrelation
3. **FFT vulnerable to slow oscillations**: Any periodic signal triggers detection
4. **Variance fails on multiple seasonalities**: Needs correct primary period

## Threshold Guidelines

| Method | Threshold | Calibration (95th percentile) |
|--------|-----------|------------------------------|
| Variance Strength | 0.2 | ~0.17 on noise |
| Spectral Strength | 0.3 | ~0.29 on noise |
| Wavelet Strength | 0.26 | ~0.24 on noise |
| FFT Confidence | 6.0 | ~5.7 on noise |
| ACF Confidence | 0.25 | ~0.22 on noise |
| AIC Difference | 0 | Fourier better = positive |

## Recommendations

### For Known Period: Variance Strength

```r
strength <- seasonal_strength(fd, period = period, method = "variance")
is_seasonal <- strength > 0.2
```

### For Time-Varying Signals: Wavelet Strength

```r
strength <- seasonal_strength(fd, period = period, method = "wavelet")
is_seasonal <- strength > 0.26
```

### Ensemble Approach (Most Robust)

```r
var_detected <- seasonal_strength(fd, period, method = "variance") > 0.2
spec_detected <- seasonal_strength(fd, period, method = "spectral") > 0.3
wav_detected <- seasonal_strength(fd, period, method = "wavelet") > 0.26

# Majority vote
is_seasonal <- (var_detected + spec_detected + wav_detected) >= 2
```

# Conclusion

For detecting seasonality in functional time series:

1. **Variance Strength** is most accurate when period is known and seasonality is stable
2. **Spectral Strength** is most robust to confounding trends
3. **Wavelet Strength** handles time-varying seasonality better than global methods
4. **FFT Confidence** works well but fails on slow oscillations and red noise
5. **AIC Comparison** provides interpretable results but has higher FPR
6. **ACF Confidence** is conservative but misses weak seasonality

For real-world data, consider:

- Pre-filtering outliers before detection
- Using wavelet method for non-stationary signals
- Avoiding FFT when autocorrelated noise is suspected
- Following up detection with amplitude modulation characterization

\newpage

# Appendix: Fourier vs P-spline Comparison

![Fourier vs P-spline AIC comparison](plots/seasonal_basis_comparison.pdf){width="7in"}

# Appendix: File Listing

All simulation scripts and results are in `scripts/seasonal_simulation/`:

- `seasonality_detection_comparison.R` -- Main comparison (Baseline)
- `seasonality_detection_with_trend.R` -- Non-linear trend study
- `seasonality_detection_trend_types.R` -- Multiple trend types
- `seasonality_robustness_tests.R` -- Red noise, multi-seasonal, AM, outliers
- `seasonal_basis_comparison.R` -- Fourier vs P-spline AIC study
- `generate_training_data.R` -- Generate training data for ML classifiers

PDF outputs are in the `plots/` subfolder.
